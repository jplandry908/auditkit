# M365 Service Coverage

What AuditKit scans in Microsoft 365 via ScubaGear integration.

---

## Overview

**Coverage:** 100+ rules via CISA ScubaGear integration  
**Supported in:** Free and Pro versions  
**Method:** Import ScubaGear scan results into AuditKit

**Supported frameworks:**
- SOC2 Type II
- PCI-DSS v4.0
- CMMC Level 1 and Level 2
- HIPAA
- NIST 800-53 Rev 5

**Why ScubaGear?**
- Official CISA tool for M365 security
- Free and open-source
- Comprehensive security baseline
- Regular updates from CISA

---

## How It Works

```
1. Run ScubaGear (Windows PowerShell)
   ↓
2. Generate ScubaResults.json
   ↓
3. Import to AuditKit
   ↓
4. Get compliance-mapped report
```

**[Setup guide →](../setup/m365.md)**

---

## Covered Domains

### Entra ID (Azure AD) - 29 Rules

#### Authentication & Access
- **MS.AAD.1.1v1** - MFA enforcement for all users
- **MS.AAD.2.1v1** - Conditional Access policies required
- **MS.AAD.2.2v1** - Block legacy authentication
- **MS.AAD.2.3v1** - Risk-based sign-in policies
- **MS.AAD.2.4v1** - User risk policies
- **MS.AAD.3.1v1** - Privileged Identity Management
- **MS.AAD.3.2v1** - Admin MFA requirements
- **MS.AAD.3.3v1** - Emergency access accounts

#### Identity Protection
- **MS.AAD.4.1v1** - Identity Protection enabled
- **MS.AAD.4.2v1** - High-risk user policy
- **MS.AAD.4.3v1** - High-risk sign-in policy
- **MS.AAD.4.4v1** - Password protection

#### Guest Access
- **MS.AAD.5.1v1** - Guest access restrictions
- **MS.AAD.5.2v1** - Guest invite settings
- **MS.AAD.5.3v1** - Guest user permissions

#### Password Policies
- **MS.AAD.6.1v1** - Password expiration policy
- **MS.AAD.6.2v1** - Password complexity
- **MS.AAD.6.3v1** - Self-service password reset

#### Monitoring & Reporting
- **MS.AAD.7.1v1** - Sign-in logs retention
- **MS.AAD.7.2v1** - Audit logs enabled
- **MS.AAD.7.3v1** - Risk detection alerts

**Framework mappings:**
- SOC2: CC6.1, CC6.6, CC6.7, CC7.1
- PCI-DSS: Requirement 8
- CMMC: AC.1.001, IA.1.076, IA.2.081
- HIPAA: 164.312(a)(2)(i)

---

### Exchange Online - 25 Rules

#### Anti-Phishing
- **MS.EXO.1.1v1** - Anti-phishing policy enabled
- **MS.EXO.1.2v1** - Impersonation protection
- **MS.EXO.1.3v1** - Mailbox intelligence
- **MS.EXO.1.4v1** - Safety tips enabled

#### Anti-Malware
- **MS.EXO.2.1v1** - Anti-malware policies configured
- **MS.EXO.2.2v1** - Common attachments filter
- **MS.EXO.2.3v1** - Zero-hour auto purge (ZAP)

#### Data Loss Prevention
- **MS.EXO.3.1v1** - DLP policies for email
- **MS.EXO.3.2v1** - Sensitive information types
- **MS.EXO.3.3v1** - Policy tips configured
- **MS.EXO.3.4v1** - Incident reports

#### Email Encryption
- **MS.EXO.4.1v1** - Message encryption enabled
- **MS.EXO.4.2v1** - IRM for emails
- **MS.EXO.4.3v1** - TLS enforcement

#### Auditing
- **MS.EXO.5.1v1** - Mailbox auditing enabled
- **MS.EXO.5.2v1** - Admin audit log
- **MS.EXO.5.3v1** - Audit log retention

#### Safe Links & Attachments
- **MS.EXO.6.1v1** - Safe Links enabled
- **MS.EXO.6.2v1** - Safe Attachments enabled
- **MS.EXO.6.3v1** - Real-time detonation

#### Transport Rules
- **MS.EXO.7.1v1** - External email warnings
- **MS.EXO.7.2v1** - DKIM signing enabled
- **MS.EXO.7.3v1** - SPF and DMARC configured

**Framework mappings:**
- SOC2: CC6.2, CC7.2, CC8.1
- PCI-DSS: Requirement 3, 4
- CMMC: SC.1.175, SC.2.179
- HIPAA: 164.312(a)(2)(iv), 164.312(e)(1)

---

### SharePoint - 20 Rules

#### Sharing & Access
- **MS.SPO.1.1v1** - External sharing restrictions
- **MS.SPO.1.2v1** - Guest access policies
- **MS.SPO.1.3v1** - Link sharing defaults
- **MS.SPO.1.4v1** - Anonymous access disabled

#### Data Loss Prevention
- **MS.SPO.2.1v1** - DLP policies for SharePoint
- **MS.SPO.2.2v1** - Sensitive document labels
- **MS.SPO.2.3v1** - Information barriers

#### Information Rights Management
- **MS.SPO.3.1v1** - IRM enabled
- **MS.SPO.3.2v1** - Document encryption
- **MS.SPO.3.3v1** - Download restrictions

#### Access Controls
- **MS.SPO.4.1v1** - Conditional Access for SharePoint
- **MS.SPO.4.2v1** - Device access policies
- **MS.SPO.4.3v1** - IP-based restrictions

#### Auditing
- **MS.SPO.5.1v1** - Audit logging enabled
- **MS.SPO.5.2v1** - Version history
- **MS.SPO.5.3v1** - Retention policies

#### Site Security
- **MS.SPO.6.1v1** - Site creation restrictions
- **MS.SPO.6.2v1** - Custom scripts disabled
- **MS.SPO.6.3v1** - Legacy authentication blocked

**Framework mappings:**
- SOC2: CC6.1, CC6.2, CC7.2, CC8.1
- PCI-DSS: Requirement 3, 7
- CMMC: AC.1.002, MP.1.118
- HIPAA: 164.308(a)(3)(i), 164.312(a)(1)

---

### Teams - 15 Rules

#### Meeting Security
- **MS.TEAMS.1.1v1** - Lobby settings enforced
- **MS.TEAMS.1.2v1** - Anonymous join disabled
- **MS.TEAMS.1.3v1** - Recording policies
- **MS.TEAMS.1.4v1** - Screen sharing restrictions

#### External Access
- **MS.TEAMS.2.1v1** - External access settings
- **MS.TEAMS.2.2v1** - Guest access policies
- **MS.TEAMS.2.3v1** - Federation settings

#### Data Protection
- **MS.TEAMS.3.1v1** - DLP policies for Teams
- **MS.TEAMS.3.2v1** - Message retention
- **MS.TEAMS.3.3v1** - eDiscovery holds

#### Calling & Devices
- **MS.TEAMS.4.1v1** - Emergency calling policies
- **MS.TEAMS.4.2v1** - Device management
- **MS.TEAMS.4.3v1** - Calling restrictions

#### Compliance
- **MS.TEAMS.5.1v1** - Audit logging enabled
- **MS.TEAMS.5.2v1** - Compliance recording

**Framework mappings:**
- SOC2: CC6.2, CC7.2
- PCI-DSS: Requirement 4
- CMMC: SC.1.176
- HIPAA: 164.312(a)(2)(iv)

---

### Power Platform - 12 Rules

#### DLP Policies
- **MS.POWERPLATFORM.1.1v1** - DLP policies configured
- **MS.POWERPLATFORM.1.2v1** - Connector classification
- **MS.POWERPLATFORM.1.3v1** - Business data protection

#### Environment Management
- **MS.POWERPLATFORM.2.1v1** - Environment creation restrictions
- **MS.POWERPLATFORM.2.2v1** - Default environment security
- **MS.POWERPLATFORM.2.3v1** - Database encryption

#### Power Apps
- **MS.POWERPLATFORM.3.1v1** - App sharing policies
- **MS.POWERPLATFORM.3.2v1** - Connector governance
- **MS.POWERPLATFORM.3.3v1** - Trial environment controls

#### Auditing
- **MS.POWERPLATFORM.4.1v1** - Audit logging enabled
- **MS.POWERPLATFORM.4.2v1** - Usage analytics
- **MS.POWERPLATFORM.4.3v1** - Compliance center integration

**Framework mappings:**
- SOC2: CC6.1, CC6.8
- CMMC: AC.1.001, AC.2.016
- HIPAA: 164.308(a)(4)(i)

---

### Power BI - 8 Rules

#### Tenant Settings
- **MS.POWERBI.1.1v1** - External sharing disabled
- **MS.POWERBI.1.2v1** - Publish to web disabled
- **MS.POWERBI.1.3v1** - Export restrictions

#### Workspace Security
- **MS.POWERBI.2.1v1** - Workspace creation restrictions
- **MS.POWERBI.2.2v1** - Sensitivity labels applied

#### Data Protection
- **MS.POWERBI.3.1v1** - Information protection
- **MS.POWERBI.3.2v1** - Data lineage tracking
- **MS.POWERBI.3.3v1** - Encryption at rest

**Framework mappings:**
- SOC2: CC6.2, CC8.1
- CMMC: AC.1.002

---

### Defender for Office 365 - 10 Rules

#### Safe Links
- **MS.DEFENDER.1.1v1** - Safe Links enabled
- **MS.DEFENDER.1.2v1** - Real-time URL scanning
- **MS.DEFENDER.1.3v1** - Safe Links for Teams

#### Safe Attachments
- **MS.DEFENDER.2.1v1** - Safe Attachments enabled
- **MS.DEFENDER.2.2v1** - Dynamic delivery
- **MS.DEFENDER.2.3v1** - Safe attachments for SharePoint

#### Anti-Phishing
- **MS.DEFENDER.3.1v1** - Advanced anti-phishing
- **MS.DEFENDER.3.2v1** - Spoof intelligence
- **MS.DEFENDER.3.3v1** - Mailbox intelligence

#### Investigation
- **MS.DEFENDER.4.1v1** - Automated investigation enabled

**Framework mappings:**
- SOC2: CC7.2, CC7.3
- PCI-DSS: Requirement 5
- CMMC: SI.1.211, SI.1.212

---

## Running M365 Scans

### Step 1: Run ScubaGear (Windows PowerShell)

```powershell
# Install ScubaGear
Install-Module -Name ScubaGear

# Run scan (all domains)
Invoke-SCuBA -ProductNames aad,exo,sharepoint,teams,powerplatform,defender -OutPath ./ScubaResults

# Run scan (specific domains)
Invoke-SCuBA -ProductNames aad,exo -OutPath ./ScubaResults
```

### Step 2: Import to AuditKit

```bash
# Import results
./auditkit integrate -source scubagear -file ScubaResults/ScubaResults.json

# Generate PDF report
./auditkit integrate -source scubagear -file ScubaResults.json -format pdf -output m365-report.pdf

# Generate HTML report
./auditkit integrate -source scubagear -file ScubaResults.json -format html -output m365-report.html
```

---

## M365 License Requirements

### Free M365 Features
- Basic Entra ID (formerly Azure AD Free)
- Exchange Online (Plan 1)
- SharePoint Online (Plan 1)
- Teams (basic)

**Limitations:** Many security features require premium licenses

### Premium Features Required

**Azure AD Premium P1** ($6/user/month)
- Conditional Access
- Self-service password reset
- Dynamic groups

**Azure AD Premium P2** ($9/user/month)
- Identity Protection
- Privileged Identity Management
- Risk-based policies

**Microsoft 365 E3** ($36/user/month)
- Advanced DLP
- Information Rights Management
- Advanced auditing

**Microsoft 365 E5** ($57/user/month)
- Defender for Office 365 Plan 2
- Advanced threat protection
- Cloud App Security

**AuditKit reports which features require premium licenses**

---

## Comparison with Native Azure

| Domain | AuditKit M365 (ScubaGear) | AuditKit Azure |
|--------|---------------------------|----------------|
| Entra ID | Via ScubaGear (29 rules) | Via Azure scan (12 checks) |
| Exchange Online | Via ScubaGear (25 rules) | Not covered |
| SharePoint | Via ScubaGear (20 rules) | Not covered |
| Teams | Via ScubaGear (15 rules) | Not covered |
| Power Platform | Via ScubaGear (12 rules) | Not covered |
| Azure Infrastructure | Not covered | Via Azure scan (64 checks) |

**Recommendation:** Run both for complete coverage
```bash
# Scan Azure infrastructure
./auditkit scan -provider azure -framework soc2

# Scan M365 applications
Invoke-SCuBA -ProductNames aad,exo,sharepoint,teams -OutPath ./ScubaResults
./auditkit integrate -source scubagear -file ScubaResults.json
```

---

## Next Steps

- **[M365 Setup Guide →](../setup/m365.md)**
- **[Getting Started →](../getting-started.md)**
- **[Azure Provider Coverage →](./azure.md)**
- **[CLI Reference →](../cli-reference.md)**
